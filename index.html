<script src="base64.js"></script>
<h1>Soon...</h1>
<h2>Airplay test</h2>
<img id="photo" />
<script>

function xhr( method, url, data, callback )
{
  var req = null;
  if( window.XMLHttpRequest ) req = new XMLHttpRequest();
  if( window.ActiveXObject )
  {
    var names = [ 'Msxml2.XMLHTTP.6.0', 'Msxml2.XMLHTTP.3.0', 'Msxml2.XMLHTTP', 'Microsoft.XMLHTTP' ];
    for( var i in names )
    {
      try{ req = ActiveXObject( names[ i ] ); break; }
      catch( e ) { }
    }
  }
  if( req == null )
  {
    alert( 'Browser not supported' );
    return;
  }
  req.onreadystatechange = function() { callback( req ) };
  req.open( method, url, true );
  if( method == 'GET' ) req.overrideMimeType( 'text/plain; charset=x-user-defined' );
  if( method == 'POST' ) req.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' );
  if( method == 'PUT' )
  {
    //req.setRequestHeader( 'User-Agent', 'MediaControl/1.0' );
    req.setRequestHeader( 'X-Apple-Transition', 'None' );
    //req.setRequestHeader( 'Content-Length', data.length );
  }
  req.send( data );
}

xhr( 'GET', 'airplay.jpg', null, function( r ) { if( r.readyState == 4 ) { document.getElementById( 'photo' ).src = 'data:image/jpeg;base64,' + base64encode( r.responseText ); airplay( r.responseText ); } } );


function airplay( data )
{
  xhr( 'PUT', 'http://appletv.local:7000/photo', data, function( r ) { if( r.readyState == 4 ) alert( r.status + ', ' + r.responseText ); } );
}

</script>